<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title> –î–µ—Ç–∞–ª—ñ</title>

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        table { border-collapse: collapse; width: 100%; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: left; }
        th { background-color: #f1f1f1; }
        .top-actions { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; align-items: flex-end; }
        .folder-link { font-weight: bold; color: #0056b3; text-decoration: none; }
    </style>
</head>
<body>

<form th:action="@{/logout}" method="post" style="position:absolute; top:20px; right:20px;">
    <button type="submit">–í–∏–π—Ç–∏</button>
</form>

<h2>
    –ê—Ä—Ö—ñ–≤: <span th:text="${archive.name}"></span>
    <small th:text="'(' + ${archive.archiveTypeId} + ')'"></small>
</h2>

<div th:if="${param.verify}" style="margin: 20px 0; text-align: center; padding: 15px; border: 1px solid #ccc; border-radius: 5px;">
    <div th:if="${param.verify[0] == 'true'}" style="color:green; font-weight:bold; background-color: #d4edda; padding: 10px; border-radius: 4px;">
        –ê—Ä—Ö—ñ–≤ —Ü—ñ–ª–∏–π
    </div>
    <div th:if="${param.verify[0] == 'false'}" style="color:red; font-weight:bold; background-color: #f8d7da; padding: 10px; border-radius: 4px;">
        –ê—Ä—Ö—ñ–≤ –ø–æ—à–∫–æ–¥–∂–µ–Ω–∏–π
    </div>
</div>

<a th:href="@{'/archive/view/' + ${archive.id}}">ROOT</a>
<span th:if="${currentPath != ''}">
    / <span th:text="${currentPath}"></span>
    <a th:if="${currentPath.contains('/')}"
       th:href="@{'/archive/view/' + ${archive.id}(path=${currentPath.substring(0, currentPath.lastIndexOf('/'))})}">
        –í–≥–æ—Ä—É
    </a>
    <a th:if="${!currentPath.contains('/')}"
       th:href="@{'/archive/view/' + ${archive.id}}">
        –í–≥–æ—Ä—É
    </a>
</span>

<div class="top-actions">

    <div>
        <form th:action="@{'/archive/edit/' + ${archive.id} + '/add-file'}"
              method="post" enctype="multipart/form-data">
            <input type="hidden" name="path" th:value="${currentPath}"/>
            <input type="file" name="file" required />
            <button type="submit">–î–æ–¥–∞—Ç–∏ —Ñ–∞–π–ª</button>
        </form>
    </div>

    <div>
        <form th:action="@{'/archive/edit/' + ${archive.id} + '/create-folder'}" method="post">
            <input type="hidden" name="path" th:value="${currentPath}"/>
            <input type="text" name="folderName" placeholder="–ù–∞–∑–≤–∞ –ø–∞–ø–∫–∏" required/>
            <button type="submit">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ø–∞–ø–∫—É</button>
        </form>
    </div>

    <div>
        <form th:action="@{'/archive/check/' + ${archive.id}}" method="post">
            <input type="hidden" name="path" th:value="${currentPath}"/>
            <button type="submit">–ü–µ—Ä–µ–≤—ñ—Ä–∏—Ç–∏ —Ü—ñ–ª—ñ—Å–Ω—ñ—Å—Ç—å</button>
        </form>
    </div>

    <div>
        <form th:action="@{'/archive/split/' + ${archive.id}}" method="post" style="display:flex; align-items:center; gap:5px;">
            <label>–†–æ–∑–±–∏—Ç—Ç—è:</label>
				<input type="number" name="sizeMb" value="1" min="1" required style="width:50px; padding:5px;" />
            <button type="submit">–†–æ–∑–±–∏—Ç–∏</button>
        </form>
    </div>

</div>

<table>
    <thead>
    <tr>
        <th>Name</th>
        <th>Size</th>
        <th>Actions</th>
    </tr>
    </thead>

    <tbody>
    <tr th:if="${nodes.empty}">
        <td colspan="3">–¶—è –ø–∞–ø–∫–∞ –ø–æ—Ä–æ–∂–Ω—è</td>
    </tr>

    <tr th:each="n : ${nodes}">
        <td>
            <span th:if="${n.dir}">üìÅ
                <a th:href="@{'/archive/view/' + ${archive.id}(path=${n.path})}"
                   th:text="${n.name}" class="folder-link"></a>
            </span>
            <span th:if="${!n.dir}">üìÑ <span th:text="${n.name}"></span></span>
        </td>

        <td th:text="${n.dir ? '-' : n.size}"></td>

        <td>
            <form th:if="${!n.dir}" th:action="@{'/archive/edit/' + ${archive.id} + '/delete-file'}" method="post" style="display:inline;">
                <input type="hidden" name="path" th:value="${currentPath}"/>
                <input type="hidden" name="filePath" th:value="${n.path}"/>
                <button type="submit" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ —Ñ–∞–π–ª?');">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </form>

            <form th:if="${n.dir}" th:action="@{'/archive/edit/' + ${archive.id} + '/delete-folder'}" method="post" style="display:inline;">
                <input type="hidden" name="path" th:value="${currentPath}"/>
                <input type="hidden" name="folderPath" th:value="${n.path}"/>
                <button type="submit" onclick="return confirm('–í–∏–¥–∞–ª–∏—Ç–∏ –ø–∞–ø–∫—É?');">–í–∏–¥–∞–ª–∏—Ç–∏</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<div style="margin-top: 20px;">
    <a th:href="@{'/archive/download/' + ${archive.id}}">–ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –∞—Ä—Ö—ñ–≤</a>
    <a href="/archive/archives">–ù–∞–∑–∞–¥</a>
</div>

</body>
</html>